\section{The problem formulation}
\begin{figure}[b!]
	\centering
	\begin{overpic}[width = .8\columnwidth]{Figures/SFS_theory/general_sfs.png}
	\scriptsize
	\put(0,26){virtual source}
	\put(45,0.5){$\mathbf{0}$}
	\put(71,31){$\vx$}
	\put(43,15){$\vxo$}
	\begin{turn}{27}
	\put(57,-3){$|\vx - \vxo|$}
	\end{turn}
	\put(50,35){$\Omega$}
	\put(80,20.5){$\partial \Omega$}
	\end{overpic}
	\caption{Geometry for the general Sound Field Synthesis problem}
	\label{Fig:Theory:general_sfs_geometry}
\end{figure}


Now we are able the formulate the general Sound Field Synthesis problem. Consider a source-free volume $\Omega \subset \mathbb{R}^n$, bounded by a continuous set of acoustic sources forming the boundary surface $\partial \Omega$.
The enclosing source ensemble is termed as the \emph{secondary source distribution (SSD)}.
The general geometry is depicted in Figure \ref{Fig:Theory:general_sfs_geometry}.
For the sake of simplicity we assume, that the boundary is acoustically transparent and the secondary sources are acoustic point sources, i.e. described by the $n$-dimensional free field Green's function. Unless it is denoted otherwise, $G(\vx,\omega)$ refers to the 3D Green's function in the followings.
%Since dynamic loudspeakers can be modeled as 3D monopoles in the low-frequency region, this assumption is feasible for $n = 3$. The incorporation of non-ideal secondary source elements in the generalized SFS theory will be discussed in the next chapter.

With these assumptions the pressure at any $\vx \in \Omega$ is given by the sum of the individual SSD elements, written as a single layer potential \cite{Ahrens2012,Ahrens2010phd,Wierstorf2014,Schultz2014:Comparing_approaches}:
\begin{equation}
P(\vx,\omega) = \oint_{\partial \Omega} D(\vxo,\omega) G(\vx - \vxo , \omega ) \td \partial \Omega ( \vxo ).
\label{Eq:Theory:3D_SFS}
\end{equation}
The weighting factor $D(\vxo,\omega)$ is termed as the \emph{driving function} for the given SSD. 
The Sound Field Synthesis problem can be formulated as the following:
Given a \emph{target sound field}, or the sound field of a \emph{virtual source} $P(\vx,\omega)$, our aim is to solve the integral equation for $D(\vxo,\omega)$, so that the weighted sum of the SSD's sound field---i.e. the \emph{synthesized field}---equals to the target sound field. 
The problem is therefore an inverse problem and has a unique solution for general enclosures.

Comparing with the Kirchhoff-Helmholtz integral formulation \eqref{Eq:Theory:Kirchhoff-Helmholtz} it becomes clear, that SFS with a single layer SSD is not able to ensure identically zero sound field outside the enclosure. Practically, the dipole sources that would cancel the field of the monopoles outside the volume are removed from the surface.
In the present thesis free-field conditions are assumed: the exterior sound field satisfies the Sommerfeld radiation condition, thus the effect of the listening environment in practical applications is not considered. For the inclusion of room effects to the SFS problem refer to \cite{Spors2005}.

In the followings mainly planar and linear SSD geometries are considered employing 3-dimensional secondary sources.
Since dynamic loudspeakers can be modeled as 3D monopoles in the low-frequency region, this choice of SSD elements is feasible. %\footnote{Dynamic loudspeakers actually can be modeled as point sources with respect to the velocity potential, forming a pulsating point source. Due to the virtual source and secondary source interchangeability this means, that when the target sound field is that of a point source, the virtual source model will be a point source with respect to the velocity potential in practical applications.}.

% Note: Morse-Ingard formulates static and moving sources via the velocity potential. Ahrens also gives the basic SFS equations wrt. the velocity potential. However KHIE is valid for pressure, not the velocity potential: so here we should note that we model our sources as eg. point sources of pressure which has less phsyical meaning than a velocity potential point source, since the latter would model a more phsyical pulsating singularity.

\paragraph{Planar SSD geometry:}
The geometry for the planar case may be derived in the same manner as the geometry for the Rayleigh-integral: consider an enclosure of $\Omega \subset \mathbb{R}^3$, bounded by the surface consisting of a simply connected disc and a hemisphere. Refer to \cite[p.~84,p.~275]{Ahrens2012, Williams1999} for the geometry. For the sake of convenience the disc is located in the plane $\vxo = [x_0,\ 0,\ z_0]^{\mathrm{T}}$. By increasing the radius of the hemisphere to infinity and by invoking the Sommerfeld radiation condition the reproduced field is written as an integral over an infinite plane $\vxo$:
\begin{equation}
P(\vx,\omega) = \iint_{-\infty}^{\infty} D(\vxo,\omega) G(\vx - \vxo , \omega ) \td x_0 \td z_0,
\label{Eq:Theory:3D_planar_SFS}
\end{equation}
and $\Omega$ becomes the half-space $y>0$, often termed as \emph{target half-space}.
$p(\vx,t)$ therefore satisfies the inhomogeneous wave equation with homogeneous Neumann boundary condition
\begin{equation}
\nabla^2 p(\vx,t) - \frac{1}{c^2}\frac{\partial^2}{\partial t^2} p(\vx,t) = - d(x,z,t)\delta(y).
\label{Eq:Theory:3D_planar_SFS_time}
\end{equation}
The planar SSD geometry is depicted in Figure \ref{Fig:Theory:planar_linear_geometry} (a).

\paragraph{Linear SSD geometry:}
From the practical point of view the application of a planar loudspeaker geometry is unfeasible.
Instead, in practical arrangements a linear ensemble of 3D point sources is utilized.
For a linear SSD positioned at $\vxo = [x_0,\ 0,\ 0]^{\mathrm{T}}$ the synthesized field reads
\begin{equation}
P(\vx,\omega) = \int_{-\infty}^{\infty} D(\vxo,\omega) G(\vx - \vxo , \omega ) \td x_0.
\label{Eq:Theory:Linear_SFS}
\end{equation}
%
\begin{figure} 
	\centering
	\begin{overpic}[width = .8\columnwidth]{Figures/SFS_theory/planar_linear_geometry.png}
	\put(-10,5){(a)}
	\put(45,5){(b)}
	\footnotesize
	\put(34.5,41){$x$}
	\put(40,26){$y$}
	\put(16,54){$z$}
	%
	\put(91,41){$x$}
	\put(96,26){$y$}
	\put(84,26){$\yref$}
	\put(62,26){$-\yref$}
	\put(72,54){$z$}
	\end{overpic}
	\caption{Geometry for the SFS problem applying a planar (a) and linear (b) set of secondary sources. In both cases from practical reasons 3D point sources are considered as SSD elements.}
	\label{Fig:Theory:planar_linear_geometry}
\end{figure}
%
Equation \eqref{Eq:Theory:Linear_SFS} describes a cylindrically symmetric sound field with the symmetry axis being the SSD. In practice we restrict the investigation of the synthesized field to the horizontal half-plane containing the SSD, ie. $z = 0, y>0$, termed as the \emph{synthesis-plane}.
Furthermore, even the explicit solution for the linear problem allows us to ensure theoretically perfect synthesis only along a line parallel to the SSD, termed as the \emph{reference line}. 
Refer to Figure \ref{Fig:Theory:planar_linear_geometry} for the linear SFS geometry.
Obviously, in this case the SSD is no longer an enclosing surface: the target space is of $\Omega \subset \mathbb{R}^2$, with the application of 3D point sources instead of 2D ones. Due to this dimensional mismatch---resulting in severe restrictions on the nature of the target sound field---this type of synthesis is referred to as \emph{2.5D synthesis}. 

\vspace{3mm}
There are several approaches to solve the SFS problem including physically based implicit and particularly  mathematical explicit solutions. 
Explicit solutions aim to solve the inverse problem directly, while implicit approaches transform the KHIE to the form of \eqref{Eq:Theory:3D_SFS} with taking the SSD geometry into consideration, thus the obtained single layer potential implicitly contains the driving functions.
For special geometries---planar, linear, spherical, circular or cylindrical SSDs---analytical expressions are available. In the following these approaches are outlined focusing on planar and linear SSD arrays.

\paragraph{Virtual Source Models}
Regarding the target sound field two approaches exist: \emph{data-based rendering} and \emph{model-based rendering}. The first is applied for the resynthesis of a wave field captured by a microphone array (citation). In the second case an analytical description of the target sound field is available. In the present treatise exclusively model-based synthesis is considered. The discussed models include virtual plane waves, point sources and infinite line sources.

% no 3D monopole can be synthesized with 2D arrays

\newpage
\section{Explicit solution: The Spectral Division Method}

The explicit solution for the general SFS problem utilizes compact operator theory by exploiting that integral \eqref{Eq:Theory:3D_SFS} constitutes a compact Fredholm operator with the kernel being the Green's function $G(\vx - \vxo , \omega )$ \cite{Ahrens2012,MorseFeshbach1953}.
Such an operator and the involved acoustic fields can by expanded into the series of orthogonal eigenfunctions of the wave equation on the boundary surface $\partial \Omega$, that form a complete basis of the solution.
The inverse problem can be straightforwardly solved for the driving function expansion coefficients by a comparison of the corresponding eigenvalues, as long as none of the expansion coefficients of the operator kernel is zero.
Otherwise the problem is termed \emph{ill-conditioned}.
Finally the explicit analytical solution is found for the driving function as an infinite sum of the weighted basis functions.
The method is often referred to as \emph{mode-matching} solutions, since the eigenfunctions of the given geometry are termed the \emph{modes}.

This solution utilizing the single layer potential is unique for general enclosures and also for the---strictly speaking---non-enclosing planar case as shown in \cite{Zotter2013:uniqueness} and \cite{Fazi2010} respectively. In contrary sound field control utilizing the Kirchhoff-Helmholtz formulation would be non-unique on the eigenfrequencies of the enclosure due to resonance phenomena.

The determination of the appropriate eigenfunctions for a general geometry is a tough challenge.
For spherical and circular geometries spherical and circular harmonics form the demanded basis functions. For a rigorous treatment for mode-matching SFS using spherical and circular SSDs see \cite{Ahrens2010phd,Zotter2009phd,Ahrens2012,Ahrens2009:circularSSD_mismatch,Ahrens2009:circular25D_SFR,Ahrens2008:Analytical_Circ_Spherical_SFS}.
In the present thesis only the planar and linear geometries are investigated in details.

\subsection{Planar SSD geometry}

For the planar geometry Equation \eqref{Eq:Theory:3D_planar_SFS} is termed a Fredholm-integral of the first kind. Due to the infinite integration limit such integrals are called \emph{singular integrals}, thus not forming a compact operator \cite[p.~921.]{MorseFeshbach1953}. 
In this case the infinite, non-denumerable eigenvalues of the problem form a continuous function \cite{MorseFeshbach1953,Schultz2014:Comparing_approaches}.
However, due to the reciprocity of the integration kernel the inverse problem can be solved applying the convolution theorem, utilizing that basically \eqref{Eq:Theory:3D_planar_SFS} describes a continuous convolution along the $y=0$ plane:
\begin{equation}
P(\vx,\omega) = D(x,z,\omega)\ast_{x} \ast_{z} G(x,y,z,\omega).
\end{equation}
Here $G(x,y,z,\omega)$ denotes the sound field of a secondary source element placed at the origin.

For the infinite planar geometry the orthogonal basis is given by the continuous set of exponentials, therefore the decomposition of the involved quantities is given by a double Fourier-transform \cite{Ahrens2012, Arfken2005,Schultz2014:Comparing_approaches}, with the physical interpretation of a plane wave decomposition:
Applying the convolution theorem to the angular spectrum representation the convolution may be transformed into a multiplication \cite{Girod2001}:
\begin{equation}
\tilde{P}(k_x,y,k_z, \omega) = \tilde{D}(k_x,k_z, \omega)  \tilde{G}(k_x,y,k_z, \omega).
\end{equation}
%
%For the infinite planar geometry the orthogonal basis is given by the continuous set of exponentials, therefore the expansion of the involved quantities is given by a double inverse %Fourier-transform \cite{Ahrens2012, Arfken2005,Schultz2014:Comparing_approaches}, with the physical interpretation of a plane wave decomposition:
%\begin{equation}
%G(\vx - \vxo,\omega) = \frac{1}{4\pi^2} \iint_{-\infty}^{\infty} \tilde{G}(k_x,y,k_z, \omega)  \te^{\ti (k_x x_0 + k_z z_0)} \te^{-\ti (k_x x + k_z z)} \td k_x \td k_z.
%\label{Eq:Theory:G_x_inverse_fourier}
%\end{equation}
%\begin{equation}
%P(\vx,\omega) = \frac{1}{4\pi^2} \iint_{-\infty}^{\infty} \tilde{P}(k_x,y,k_z, \omega) \te^{-\ti (k_x x + k_z z)} \td k_x \td k_z.
%\end{equation}
%In \eqref{Eq:Theory:G_x_inverse_fourier} the translation property of the Fourier-transform is applied.
%The expansion coefficients i.e. the angular spectrum of the involved sound fields may be obtained by a forward Fourier-transform.
%
%The series expansions---along with the expansion of driving function---may be substituted into Equation \eqref{Eq:Theory:3D_planar_SFS}. By changing the order of integration, utilizing the orthogonality of the exponental functions and exploiting the sifting property of the Dirac-delta one finally obtains
%\begin{equation}
%\tilde{P}(k_x,y,k_z, \omega) = \tilde{D}(k_x,k_z, \omega)  \tilde{G}(k_x,y,k_z, \omega),
%\end{equation}
%thus the convolution theorem for the Fourier-transform holds \cite{Girod2001}.
%
The expansion coefficient are therefore obtained by a comparison of spectral coefficients and the driving function takes the form:
\begin{equation}
\tilde{D}(k_x,k_z,\omega) = \frac{\tilde{P}(k_x,y,k_z, \omega)}{ \tilde{G}(k_x,y,k_z, \omega)} = 
\frac{\mathcal{F}\left\{ P(\vx,\omega) \right\} }
{  \mathcal{F}\left\{ G(\vx,\omega) \right\} },
\end{equation}
\begin{equation}
D(x_0,z_0,\omega) = \frac{1}{4\pi^2} \iint_{-\infty}^{\infty} \tilde{D}(k_x,k_z, \omega) \te^{-\ti (k_x x_0 + k_z z_0)} \td k_x \td k_z.
\label{Eq:Theory:Dkx_inverse_Fourier}
\end{equation}
Since the driving function spectrum is yielded by a division in the spectral domain the approach is termed as the \emph{Spectral Division Method} \cite{Ahrens2010a, Ahrens2012:Ambisonics_for_planar_linear, Ahrens2011:icassp, Ahrens2010:Ambisonics_w_planar_linear}.

It should be noted, that this method does not pose any constraint on the integral kernel. Theoretically an arbitrary transfer function may be assigned for the SSD elements: as long the problem is well-conditioned---i.e. the spectrum of the transfer function does not exhibit zeros---unique driving functions may be derived applying the above.

\vspace{3mm}
Generally the elements of the SSD are described by the 3D Green's function. The plane wave expansion of the 3D free field Green's function is termed as the Weyl's integral representation \cite{Williams1999, Lalor1969}:
\begin{equation}
G(\vx - \vxo,\omega ) = \frac{1}{4\pi^2} \iint_{-\infty}^{\infty} -\frac{\ti}{2}\frac{\te^{ -\ti k_y  | y - y_0 |  }}{ k_y }
\te^{\ti (k_x x_0 + k_z z_0)} \te^{-\ti (k_x x + k_z z)} \td k_x \td k_z.
\label{Eq:Theory:Weyls_integral}
\end{equation}
with $k_y$ defined as \eqref{eq:theory:k_y_definition}, thus the angular spectrum of the Green's function placed at the origin is given by
\begin{equation}
\tilde{G}(k_x,y,k_z,\omega) =-\frac{\ti}{2}\frac{\te^{ -\ti k_y  | y |  }}{ k_y },
\end{equation}
as it was already shown in table \ref{tab:theory:Greens_fun_representations}.
Applying equation \eqref{Eq:Theory:Wave_field_extrapolation} the target sound field spectrum on a fixed $(y=\mathrm{const})$ plane may be extrapolated from the field measured on $y=0$:
\begin{equation}
\tilde{P}(k_x,y,k_z,\omega) = \tilde{P}(k_x,0,k_z,\omega) \te^{- \ti k_y y}.
\label{Eq:Theory:Wave_field_extrapolation_2}
\end{equation}
By carrying out the spectral division the exponential pressure propagators cancel out, and the driving function becomes independent from the $y$-coordinate. The driving function in the wavenumber domain therefore reads
\begin{equation}
\tilde{D}(k_x,k_z,\omega) = 2\ti k_y \tilde{P}(k_x,0,k_z,\omega).
\label{Eq:Theory:Planar_explicit_driv_fun}
\end{equation}

\vspace{3mm}
In this case the spatial inverse Fourier-transform may be carried out analytically.
By taking the derivative of both sides of \eqref{Eq:Theory:Wave_field_extrapolation_2} one obtains
\begin{equation}
\frac{\partial}{\partial y}  \tilde{P}(k_x,y,k_z,\omega) = - \ti k_y  \tilde{P}(k_x,y,k_z,\omega) \te^{-\ti k_y y}.
\end{equation}
Comparison with \eqref{Eq:Theory:Planar_explicit_driv_fun} reveals, that 
\begin{equation}
\tilde{D}(k_x,k_z,\omega) = -2 \left. \frac{\partial}{\partial y} \tilde{P}(k_x,y,k_z,\omega) \right|_{y = 0}.
\label{Eq:Theory:Planar_explicit_driv_fun_spatial}
\end{equation}
Straightforwardly, the explicit expression of the driving function in the spatial domain is obtained by the corresponding inverse Fourier-transform according to \eqref{Eq:Theory:Dkx_inverse_Fourier}:
\begin{equation}
D(x_0,z_0,\omega) = -2 \left. \frac{\partial}{\partial y} P(\vx,\omega) \right|_{y = 0}.
\label{Eq:Theory:Planar_explicit_driv_fun_spatial}
\end{equation}

\subsection{Linear SSD geometry}

Similarly to the planar case the basis functions for a linear SSD are given by exponentials.
By realizing that equation \eqref{Eq:Theory:Linear_SFS} is a convolution along the $x$-axis,
the convolution is transformed into a multiplication by means of a forward Fourier-transform
\begin{equation}
\tilde{P}(k_x,y,z, \omega) = \tilde{D}(k_x,\omega)\tilde{G}(k_x,y,z, \omega).
\end{equation}
The driving function spectra is then obtained as a spectral ratio
\begin{equation}
\tilde{D}(k_x,\omega) = \frac{\tilde{P}(k_x,y,z, \omega)}{\tilde{G}(k_x,y,z, \omega)} = \frac{\mathcal{F}_x\left\{ P(\vx,\omega) \right\}}{\mathcal{F}_x\left\{ G(\vx,\omega) \right\}},
\end{equation}
and the frequency domain driving function therefore reads
\begin{equation}
D(x_0,\omega) = \frac{1}{2\pi} \int_{-\infty}^{\infty} \frac{\tilde{P}(k_x,y,z, \omega) }{\tilde{G}(k_x,y,z, \omega)} \te^{-\ti k_x x_0} \td k_x.
\label{Eq:Theory:LinearSDM1}
\end{equation}

Again, theoretically the transfer function may describe the field of an arbitrary sound source, as long as it does not exhibit zeros in order to keep the problem well-conditioned.
When applying 3D point sources as SSD elements the Fourier-transform coefficients of the Green's function is given in \ref{tab:theory:Greens_fun_representations}
\begin{equation}
\tilde{G}(k_x,y,z,\omega) = -\frac{\ti}{4} H_0^{(2)}\left( \sqrt{ \left( \frac{\omega}{c} \right)^2 - k_x^2 } \sqrt{ y^2 + z^2 } \right).
\end{equation}

\vspace{3mm}
Note, that unlike the planar case the present driving function contains both $y$ and $z$ positions, thus the driving function depends on the listener position: Equation \eqref{Eq:Theory:LinearSDM1} may be solved only for positions on the surface of a cylinder with fixed radius $d = \sqrt{y^2 + z^2}$ \cite[p.~60.]{Ahrens2010phd}.
Also since an infinite line source---i.e. the SSD---can only radiate wavefronts with cylindrical symmetry the following  dispersion relation must hold:
%
\begin{equation}
\left( \frac{\omega} {c}\right)^2 - k_x^2 = k_y^2 + k_z^2 = k_{\rho}^2,
\end{equation}
%
with $k_{\rho}$ being the radial wavenumber. This implies that for a fixed temporal frequency only component $k_x$ can be controlled individually using a linear SSD.

These restrictions will have the following consequence:
Since for a fixed $k_x$ the radial wavenumber and the propagation direction of the synthesized field is determined, phase correct synthesis may be assured only in a plane containing the SSD in which the radial wavenumber of the synthesized field and the target field coincide. Furthermore amplitude correct synthesis is assured in this plane at a distance $\dref = \sqrt{y^2 + y^2}$ for which driving functions are calculated.
%
\begin{figure} 
	\centering
	\begin{overpic}[width = .95\columnwidth]{Figures/SFS_theory/synthesis_w_linear_ssd.png}
	\footnotesize
	\put(0,2){(a)}
	\put(50,2){(b)}
	\put(17.5,30){$\dref$}
	\put(72,30){$\dref$}
	\end{overpic}
	\caption{Synthesis of a plane wave with the target sound field (a) and the synthesized field using a linear SSD (b). Since the synthesized field is cylindrically symmetric phase correct synthesis is restricted to the plane containing the SSD at $[x,\ 0,\ 0]^{\mathrm{T}}$ where the radial wavenumber of the plane wave equals to $\left( \frac{\omega}{c} \right)^2 - k_x^2$ (denoted by dotted line), while amplitude correct synthesis is restricted to a cylindrical surface with the radius of $\dref$ (denoted by dashed line)}
	\label{Fig:Theory:synthesis_w_linear_SSD}
\end{figure}

For practical applications we choose the horizontal plane $z=0$ for the plane of synthesis, and reference the driving functions to the \emph{reference line}, by setting $y = \yref$.
See Figure \ref{Fig:Theory:planar_linear_geometry} (b) for an illustration. The driving function thus reads
\begin{equation}
D(x_0,\omega) = \frac{1}{2\pi} \int_{-\infty}^{\infty} \frac{\tilde{P}(k_x,\yref,0, \omega) }{\tilde{G}(k_x,\yref,0, \omega)} \te^{-\ti k_x x_0} \td k_x.
\label{Eq:Theory:Linear_SDM}
\end{equation}
In this geometry amplitude correct synthesis is restricted to the reference line.
Furthermore, the propagation direction can be reconstructed only for those sound fields, where $k_z = 0$ in the plane $z=0$. Practically this means plane waves propagating along the horizontal plane, line sources perpendicular to the synthesis plane, or point sources located in the plane of synthesis.

Since the pressure of an arbitrary 3D sound field on the SSD does not determine completely the pressure measured on the reference line---and vice versa---therefore the explicit driving function for a linear array based on the target field measured on the SSD can not be expressed, 
as it was given by \eqref{Eq:Theory:Planar_explicit_driv_fun} for the planar case.

\vspace{3mm}
It is worth noting that the analytic Fourier-transform cofficients of the target sound field are available only for limited simple virtual source models. Even in these cases the inverse transform of the driving functions rarely can be evaluated analytically, therefore numerical transforms are needed.
For a practical and optimized implementation of the SDM for an arbitrary target sound field refer to \cite{ahrens2013a:efficientSDM}.

% To check: SDM w linear sources from the helical spectrum representation (eg. single layer potential, or scattering from a rigid line source)
%
% To check: Approximation of explicit linear SSD driving functions to by reduce it to the wavefield on the SSD (done for 2.5D synth)

% To check: why Frank writes, that no solution is known for (A12) in Schultz,Spors Analytical SFS... It is given is Fourier Acoustics (2.65)

\subsection{Application example}

As an example for the application of the SDM, the synthesis of a virtual 3D point source is presented. 

\begin{figure}
	\centering
	\begin{overpic}[width = 1\columnwidth]{Figures/SFS_theory/Planar_SDM.png}
	\footnotesize
	\put(0, 0){(a)}
	\put(45,0){(b)}
	\end{overpic}
\caption{Synthesis of a virtual point source using a planar SSD based on SDM driving functions. The SSD is located at $\vxo = [x_0,\ 0,\ z_0]^{\mathrm{T}}$, denoted by a solid black line. The virtual source is located at $\vxs = [0,\ -1,\ 0]^{\mathrm{T}}$ oscillating at $\omega_0 = 2\pi \cdot 1000 ~\mathrm{rad/sec}$. The figures depict the crossections at $z=0$ of the synthesized field $\mathcal{R}\left( P_{\mathrm{synth}}(x,y,0,\omega) \right)$ (a) and the deviation from the target sound field $20\mathrm{log}_{10}\left( P_{\mathrm{synth}}(x,y,0,\omega) - P(x,y,0,\omega) \right)$ (b). Using a planar SSD in $y>0$ a perfect synthesis can be achieved.}
	\label{Fig:Theory:monopole_synthesis_by_planar_SDM}
\end{figure}

\vspace{3mm}
In case of 3D synthesis the virtual source is located at $\vxs = [x_s,\ y_s,\ z_s]^{\mathrm{T}}$, with $y_s<0$, i.e. behind the SSD plane.
Assuming 3D point source SSD elements the wavenumber domain representation of the driving function is obtained by substituting the angular spectrum of the virtual point source---applying the Fourier-shift theorem---into either \eqref{Eq:Theory:Dkx_inverse_Fourier} or directly to \eqref{Eq:Theory:Planar_explicit_driv_fun}:
\begin{equation}
\tilde{D}(k_x,k_z,\omega) =  \frac{-\frac{\ti}{2} \frac{ \te^{-\ti k_y | y - y_s|} }{ k_y} \te^{\ti (k_x x_s +k_z z_s)} }{-\frac{\ti}{2} \te^{-\ti k_y | y |} / k_y   } = \te^{-\ti k_y |y_s|}\te^{\ti (k_x x_s +k_z z_s)},
\end{equation}
and the spatial driving function reads
\begin{equation}
D(x_0,z_0,\omega) = \frac{1}{4\pi^2} \iint_{-\infty}^{\infty} \te^{-\ti k_y |y_s|}\te^{\ti (k_x x_s +k_z z_s)} \te^{-\ti (k_x x_0 + k_z z_0)} \td k_x \td k_z.
\label{Eq:Theory:Monopole_SDM_planar_driv_fun}
\end{equation}

The double inverse Fourier-transform may be carried out analytically, by taking the $y$-derivative of the Weyl's integral \eqref{Eq:Theory:Weyls_integral} (See \cite[(2.65)]{Williams1999}):
\begin{equation}
\frac{\partial}{\partial y} G(\vxo - \vxs,\omega ) = 
\frac{1}{4\pi^2} \iint_{-\infty}^{\infty} -\frac{1}{2} \te^{ -\ti k_y  | y - y_s |  }
\te^{\ti (k_x x_s + k_z z_s)} \te^{-\ti (k_x x_0 + k_z z_0)} \td k_x \td k_z,
\label{Eq:Theory:Weyls_derivative}
\end{equation}
Comparing \eqref{Eq:Theory:Monopole_SDM_planar_driv_fun} and \eqref{Eq:Theory:Weyls_derivative} it is revealed, that the driving function in the spatial domain is given by
\begin{equation}
D(x_0,z_0,\omega) = -2 \frac{\partial}{\partial y} \left. G(\vxo - \vxs,\omega )\right|_{y = y_0 = 0},
\end{equation}
which is in agreement with equation \eqref{Eq:Theory:Planar_explicit_driv_fun_spatial}.

The result of synthesizing a steady-state point source is illustrated in Figure \ref{Fig:Theory:monopole_synthesis_by_planar_SDM}. In the target sound field perfect synthesis is achieved, as it is indicated in Figure \ref{Fig:Theory:monopole_synthesis_by_planar_SDM} (b) depicting the difference between the synthesized and the target sound field. Since in this case the SSD is a quasi-enclosing surface, the equivalent scattering interpretation of the synthesis---detailed in the next section---holds. The image of discrepancy therefore depicts the scattering of a point source from an infinite sound soft plane. 

\begin{figure}
	\centering
	\begin{overpic}[width = 1\columnwidth]{Figures/SFS_theory/Linear_SDM.png}
	\footnotesize
	\put(0, 0){(a)}
	\put(45,0){(b)}
	\end{overpic}
\caption{Synthesis of a virtual point source using a linear SSD applying the SDM driving functions.
The SSD is located at $\vxo = [x_0,\ 0,\ 0]^{\mathrm{T}}$, denoted by a solid black line. The virtual source is located at $\vxs = [0,\ -1,\ 0]^{\mathrm{T}}$ oscillating at $\omega_0 = 2\pi \cdot 1000 ~\mathrm{rad/sec}$. The reference line was set to $\yref = 1~\mathrm{m}$.
The figure depicts the synthesized field at the synthesis plane ($z = 0$):
$\mathcal{R}\left( P_{\mathrm{synth}}(x,y,0,\omega) \right)$ (a) and the deviation from the target sound field $20\mathrm{log}_{10}\left( P_{\mathrm{synth}}(x,y,0,\omega) - P(x,y,0,\omega) \right)$ (b).}
	\label{Fig:Theory:monopole_synthesis_by_linear_SDM}
\end{figure}

\vspace{3mm}
For the case of a linear SSD the target sound field of a 3D point source, positioned at $\vxs = [x_s,\ y_s,\ 0]^{\mathrm{T}}$, with $y_s<0$ is chosen. The explicit driving function for a linear SSD is given by \eqref{Eq:Theory:Linear_SDM}. Substituting the spectra of the virtual and the secondary point sources with applying the Fourier-shift theorem the driving function reads
\begin{equation}
\hat{D}(k_x,\omega) = 
\frac{  H_0^{(2)} \left( \sqrt{ \left(\frac{\omega}{c}\right)^2 - k_x^2} |\yref - y_s| \right)  }
     {  H_0^{(2)} \left( \sqrt{ \left(\frac{\omega}{c}\right)^2 - k_x^2} |\yref|       \right)  }
\te^{\ti k_x x_s},
\end{equation}
and in the spatial domain
\begin{equation}
D(x_0,\omega) = \frac{1}{2\pi} \int_{-\infty}^{\infty} 
\frac{  H_0^{(2)} \left( \sqrt{ \left(\frac{\omega}{c}\right)^2 - k_x^2} |\yref - y_s| \right)  }
     {  H_0^{(2)} \left( \sqrt{ \left(\frac{\omega}{c}\right)^2 - k_x^2} |\yref|       \right)  }
\te^{- \ti k_x (x_0 - x_s)}
\td k_x.
\end{equation}
The synthesized field using this driving function is depicted in \ref{Fig:Theory:monopole_synthesis_by_linear_SDM} (a). 
As it can be seen from Figure (b) displaying the deviation of the synthesized field from the target field, application of the explicit driving function ensures perfect synthesis on the reference line. In other parts of the space amplitude errors are present.
\newpage

\section{Implicit solution and Wave Field Synthesis}

The implicit solution for the general SFS problem aims at the reduction of the KHIE to a single layer potential instead of the explicit solution of the inverse problem, as treated in the previous subsection. 

As we could see the KHIE describes the sound field inside the enclosure in the form of the sum of a single and a double layer potential:
\begin{equation}
P(\vx,\omega) = 
\oint_{S} - \left( 
\frac{\partial P(\vxo,\omega)}{\partial \vni} G(\vx-\vxo,\omega)
-
P(\vxo,\omega)  \frac{\partial G(\vx-\vxo,\omega)}{\partial\vni} 
\right)   \td \partial \Omega( \vxo),
\end{equation}
with $\vx \in \Omega$,  $\Omega \subset \mathbb{R}^n$.
In order to let the double layer vanish two different approaches exist:
\begin{itemize}
\item Imposing homogeneous Dirichlet boundary conditions on the total field---which in the interior equals to the target sound field---in an equivalent scattering problem: 
\begin{equation}
P(\vxo,\omega) = 0.
\end{equation}
The resulting single layer potential is termed as the \emph{simple source formulation}.
\item Deriving the Neumann Green's function with vanishing normal derivative on the boundary:
\begin{equation}
\frac{\partial G(\vx|\vxo,\omega)}{\partial n}  = 0.
\end{equation}
\end{itemize}
In section \ref{Section:Theory:Rayleigh} the Rayleigh-integrals were introduced from the latter, Neumann Green's function approach, following \cite{Berkhout1984}. Since Rayleigh integrals represent a single layer potential applying the free field Green's function, this formulation can be used directly for SFS applying a planar SSD. 
This property however can not be generalized: in general geometries the resulting Neumann Green's function can not be expressed in terms of the free field Green's function, therefore the obtained formulation---although being a single layer potential---can not be realized in practice with real life sound sources \cite{Schultz2014:Comparing_approaches}.

For the sake of completeness it is shown here that the simple source formulation theoretically ensures realizable driving functions for an arbitrary geometry, leading to the same result for the planar case as the Neumann Green's function approach. The didactic importance of this solution along with the equivalent scattering interpretation stems from the further simplification of the resulting driving functions, based on the Kirchhoff-approximation lent from classic scattering theory. This latter forms the backbone of the extension of WFS for arbitrary SSD geometries.

%\begin{figure}
%	\centering
%	\begin{overpic}[width = 1\columnwidth]{Figures/SFS_theory/simple_source_formulation.png}
%	\put(0, 50){(a)}
%	\put(50,50){(b)}
%	\put(0,  0){(c)}
%	\put(50, 0){(d)}
%	%\put(22,70){$P_i$}
%	\put(33, 92){$P(\vx,\omega)$}
%	\put(83, 92){$P_e(\vx,\omega)$}
%	\put(33, 42){$P_{\mathrm{synth}}$}
%	\put(77, 42){$P_T = P - P_{\mathrm{synth}}$}
%	\put(27,80){$\Omega_i$}
%	\put(33,72){$\partial \Omega$}
%	%\put(60,60){$P_e$}
%	\put(85,87){$\Omega_e$}
%	\put(83,72){$\partial \Omega$}
%	\end{overpic}
%\caption{Illustration of simple source formulation in a 2D SFS problem ($\Omega \subset \mathbb{R}^2$) with a circular SSD at $R_0 = 1~\mathrm{m}$: The incident field, to be synthesized is the field of a 2D point source, described by $G_{\mathrm{2D}}(\vx-\vxo,\omega)$, $\vxo = [-1.5,\ 1.5]^{\mathrm{T}}~\mathrm{m}$, depicted in (a). For a circular SSD contour the interior and exterior fields may be calculated analytically using \cite[Eq.~4.57]{Williams1999} with $k_z=0$, and using $J_n()$ for the interior problem. The resulting exterior field is depicted in (b), while the interior solution is the target field in $\Omega_i$ in (a). Due to the separated variables normal derivatives in equation \eqref{Eq:Theory:Simple_source_HIE}---which means radial derivative in the present setup---are calculated analytically. The obtained strength function is $D(\varphi,\omega) = \sum_{n = 0}^{k} \te^{\ti n \phi} k C_n(\omega) \left( \frac{J'_n(k R_0)}{J_n(k R_0)} - \frac{H_n^{'(2)}(k R_0)}{H_n^{(2)}(k R_0)} \right),$ with $C_n(\omega)$ being the incident pressure spectrum on $\partial \Omega$. The synthesized field, depicted in (c), is calculated by evaluating \eqref{Eq:Theory:3D_SFS}. In $\Omega_i$ the synthesized field equals to the target sound field. The solution of the equivalent scattering problem is depicted in (d) constructed from the simple source approach.}
%	\label{Fig:Theory:simple_source_formulation}
%\end{figure}


\subsection{Simple Source Formulation/Equivalent Scattering Problem}
The simple source formulation is derived from the KHIE by the construction of a separate exterior and interior radiation problem with prescribing the same inhomogeneous Dirichlet boundary condition for both fields on the boundary surface $\partial \Omega$ \cite{Ahrens2012}.

Let's assume an exterior sound field $P_{\mathrm{e}}(\vx,\omega)$, satisfying the homogeneous Helmholtz equation at $\vx \in \Omega_{\mathrm{e}}$, i.e. that all sources are located within the enclosure. The exterior wave field is the combination of radiating, or diverging waves. On the other hand assume an interior sound field $P_{\mathrm{i}}(\vx,\omega)$ inside the enclosure $\vx \in \Omega$, induced by a sound source located outside the volume of investigation, thus the interior field also satisfies the homogeneous Helmholtz equation constructed by a set of incoming or converging waves.
The two spatially disjunct problems are connected through the following boundary condition written onto the boundary surface
\begin{equation}
P_{\mathrm{e}}(\vxo,\omega) = P_{\mathrm{i}}(\vxo,\omega), \hspace{15mm} \vxo \in \partial \Omega.
\end{equation}
Both fields may be expressed in terms of an exterior and an interior KHIE respectively, for the exterior KHIE with inward normals refer to \cite[eq. 8.30]{Williams1999}.
By adding the exterior and interior KHIEs, due to the coupled boundary condition terms, weighted by the pressure on the boundary vanish and the following integral expression is obtained \cite[p.~268.]{Williams1999}
\begin{equation}
\oint_{\partial \Omega} 
G(\vx|\vxo,\omega) 
\left(
\frac{\partial P_{\mathrm{e}}(\vxo,\omega)}{\partial \vni} - \frac{\partial P_{\mathrm{i}}(\vxo,\omega)}{\partial \vni} 
\right)
\td \partial \Omega ( \vxo)
= 
\begin{cases} 
P_{\mathrm{e}}(\vx,\omega)           & \hspace{1mm} \forall \hspace{5mm}  \vx \in \Omega_e  	   \\
P_{\mathrm{e}}=P_{\mathrm{i}} & \hspace{1mm} \forall \hspace{5mm}         \vx \in \partial \Omega  \\
P_{\mathrm{i}}(\vx,\omega) 			& \hspace{1mm} \forall \hspace{5mm}   \vx \in \Omega_i.
\end{cases}
\label{Eq:Theory:Simple_source_HIE}
\end{equation}
The equation states that either the interior or the exterior sound field, satisfying the homogeneous Helmholtz equation may be determined as a single layer potential, by constructing the corresponding exterior or interior problems, respectively.
The \emph{single layer strength function} is given in the integral \eqref{Eq:Theory:Simple_source_HIE} implicitly.
The discontinuity in the pressure gradient is termed as the \emph{jump relation}, expressing the fact that the sound field generated by the single layer potential continuous in pressure on the boundary $\partial \Omega$, while the gradient changes sign i.e. \emph{jumps}.

\begin{figure}[h!]
	\centering
	\begin{overpic}[width = 1\columnwidth]{Figures/SFS_theory/simple_source_formulation_2.png}
%	\put(0, 50){(a)}
%	\put(50,50){(b)}
%	\put(0,  0){(c)}
%	\put(50, 0){(d)}
%	%\put(22,70){$P_i$}
%	\put(33, 92){$P(\vx,\omega)$}
%	\put(83, 92){$P_e(\vx,\omega)$}
%	\put(33, 42){$P_{\mathrm{synth}}$}
%	\put(77, 42){$P_T = P - P_{\mathrm{synth}}$}
%	\put(27,80){$\Omega_i$}
%	\put(33,72){$\partial \Omega$}
%	%\put(60,60){$P_e$}
%	\put(85,87){$\Omega_e$}
%	\put(83,72){$\partial \Omega$}
	\end{overpic}
\caption{Illustration of simple source formulation in a 2D SFS problem ($\Omega \subset \mathbb{R}^2$).}
	\label{Fig:Theory:simple_source_formulation}
\end{figure}

In terms of sound field synthesis the interior sound field is the desired sound field itself. The simple source formulation therefore states that for an arbitrary geometry the SSD driving function is given by
\begin{equation}
D(\vxo,\omega) = 
\frac{\partial P_{\mathrm{e}}(\vxo,\omega)}{\partial \vni} - \frac{\partial P(\vxo,\omega)}{\partial \vni},
\label{Eq:Theory:Source_strength}
\end{equation}
where $P_{\mathrm{e}}(\vxo,\omega)$ is the corresponding exterior sound field, needed to be calculated in order to solve the SFS problem.

\vspace{3mm}
As pointed out in \cite{Fazi2013:Equivalent_scattering, Fazi2010, Schultz2014:Comparing_approaches, Zotter2013:uniqueness} the following physical interpretation can be assigned to the simple source formulation: we assume that the surface $\partial \Omega$ represents no longer an SSD, but the boundary of a sound soft scattering object. In acoustic scattering problems we consider an a-priori known \emph{incident sound field} $P(\vx,\omega)$ that is reflected by the scattering object, generating the \emph{scattered field} $P_{\mathrm{s}}(\vx,\omega)$.
The field measured in the presence of the obstacle is termed the \emph{total field} $P_{\mathrm{t}}(\vx,\omega)$, given by the sum of the incident and scattered fields.
The scattered field is the solution of the exterior radiation problem, so that the total field obeys homogeneous boundary conditions on the sound soft scatterer surface, i.e. $P_{\mathrm{s}}(\vxo,\omega) = -P(\vxo,\omega) = - P_{\mathrm{e}}(\vxo,\omega), \hspace{.2cm} \vxo \in \partial \Omega$.
In the aspect of SFS the incident field inside the theoretical scatterer is the target sound field itself.
Comparing this result with the simple source formulation it is clear, that the single layer driving function is the derivative of $(-1)$ times the total field on the SSD.
See Figure \ref{Fig:Theory:simple_source_formulation} for an illustration of the simple source formulation and for its interpretation as an equivalence scattering problem.
Another demonstration of this principle is shown in Figure \ref{Fig:Theory:monopole_synthesis_by_planar_SDM} (b) where the difference between the synthesized field and the target sound field is the total field in the equivalent scattering problem $P_{\mathrm{t}}(\vx,\omega) = P(\vx,\omega) - P_{\mathrm{e}}(\vx,\omega)$.
%\begin{equation}
%D(\vxo,\omega) = \frac{\partial P_T(\vxo,\omega)}{\partial n}
%=
%\frac{\partial P(\vxo,\omega)}{\partial n} + \frac{\partial P_s(\vxo,\omega)}{\partial n}.
%\label{Eq:Theory:Equivalent_scattering_driv_fun}
%\end{equation}

Simple source approach---and the equivalent scattering interpretation---gives the analytical driving function for an arbitrary SSD geometry implicitly. Unfortunately the exterior scattering solution is scarcely available analytically except for simple geometries. The general application therefore would require numerical computation method, e.g. BEM. Also, when compared to the explicit solution a further drawback is that simple source approach allows only point secondary sources.

\subsection{The Kirchhoff approximation}

Before the WFS theory for a linear SSD is discussed an extension towards arbitrary SSD geometries is given applying the planar SSD driving functions.

The mathematical basis stems from the equivalent scattering problem interpretation of the general SFS problem, discussed earlier. 
In scattering problems from sound soft bodies at high frequencies the \emph{Kirchhoff/Physical Optics approximation} is frequently used, approximating the scattered field as a single layer potential \cite{Fazi2013:Equivalent_scattering, ColtonKress1998}.
The general scattering problem is modeled with the scattering of plane waves from planar surfaces with a well-known analytical solution.
If the SSD is convex (ie. the scattering of the synthesized field is avoided) and the SSD dimensions are much higher, than the physical wavelength of the incident/synthesized field the smooth SSD boundary may be considered locally planar, ie. reflections may be modeled as that of local plane waves from locally planar surfaces.

To the synthesis however only those SSD elements contribute, which are \emph{illuminated} by the incident sound field, ie. those SSD elements, whose sound field propagate into the same direction in the synthesis plane as the target sound field. Otherwise the SSD element is in the \emph{shadow region}, that's contribution to the synthesized field is set identically to zero.
Mathematically this requirement is formulated by
\begin{equation}
w(\vxo) = \begin{cases}
                        1, \hspace{3mm} \forall \hspace{3mm} \langle \mathbf{k}(\vxo) \cdot \mathbf{n}_i(\vxo) \rangle > 0 \\
                        0  \hspace{3mm} \text{elsewhere},
                    \end{cases}
\end{equation}
where $\mathbf{k}(\vxo)$ denotes wavenumber vector of the incident sound field at $\vxo$, $ \mathbf{n}_i(\vxo)$ is the inward normal of the SSD elements.
% How is wavenumber vector defined?
In the context of WFS this windowing is termed as \emph{secondary source selection criterion} \cite{Spors2007, Spors2007:DAGA:SS_selection_criterion}, which chooses out the \emph{active secondary sources}.

\begin{figure}
	\centering
	\begin{overpic}[width = 1\columnwidth]{Figures/SFS_theory/KH_approx.png}
%	\put(0, 50){(a)}
%	\put(50,50){(b)}
%	\put(0,  0){(c)}
%	\put(50, 0){(d)}
%	%\put(22,70){$P_i$}
%	\put(33, 92){$P(\vx,\omega)$}
%	\put(83, 92){$P_e(\vx,\omega)$}
%	\put(33, 42){$P_{\mathrm{synth}}$}
%	\put(77, 42){$P_T = P - P_{\mathrm{synth}}$}
%	\put(27,80){$\Omega_i$}
%	\put(33,72){$\partial \Omega$}
%	%\put(60,60){$P_e$}
%	\put(85,87){$\Omega_e$}
%	\put(83,72){$\partial \Omega$}
	\end{overpic}
\caption{Illustration of Kirchhoff approximation in a 2D SFS problem ($\Omega \subset \mathbb{R}^2$).}
	\label{Fig:Theory:simple_source_formulation}
\end{figure}


With all these approximations the general WFS driving functions for an arbitrary SSD surface reads
\begin{equation}
D(\vxo,\omega) = -2 w(\vxo) \frac{\partial}{\partial \mathbf{n}_i} \left. P(\vx,\omega) \right|_{\vx = \vxo}.
\end{equation}
This result is not exclusively valid for WFS: theoretically any planar driving function may be applied for arbitrary SSD surfaces using the Kirchhoff-approximation \cite{Ahrens2012}, however only WFS provides an easily implementable approach.

A detailed discussion on application of these approximation is given in \cite[Sec. 3.8]{Ahrens2012}.

Exclusively in the context of WFS one may deduce the same results by utilizing the Fresnel-Kirchhoff diffraction formula in order to give a single-layer high frequency approximation of the KHIE \cite[p. 215.]{Pierce1991}. Using several further approximations as given in \cite{Zotter2013:uniqueness} the same driving functions are obtained as given above.

\subsection{2D/3D Wave Field Synthesis}

Comparison of the Rayleigh-integral \eqref{Eq:Theory:RayleighI} with the planar SFS equation \eqref{Eq:Theory:3D_planar_SFS} it is revealed, that Rayleigh-integral implicitly contains the driving functions for a planar SSD and the driving function is given by
\begin{equation}
D_{\mathrm{3D}}(\vxo,\omega) = -2\frac{\partial}{\partial y} P(\vxo,\omega) = - 2 \ti \rho_0 c k V_{\mathrm{n}}(\vxo,\omega).
\label{Eq:Theory:3D_WFS_driv_fun}
\end{equation}
This forms the basic equation of traditional \emph{Wave Field Synthesis}, thus equation \eqref{Eq:Theory:3D_WFS_driv_fun} is referred to as \emph{3D WFS driving function}.

Simple physical considerations lead us to the same result from the equivalent scattering problem:
An arbitrary sound field reflected from an infinite pressure release plane is simply obtained by mirroring the sound field to the infinite plane, with a phase change of $180^{\circ}$ in order to satisfy homogeneous boundary conditions. The phase change along with the mirroring cancel out in the normal derivative, thus the derivative of the total field equals two times the derivative of the incident field.

Comparison with the explicit solution \eqref{Eq:Theory:Planar_explicit_driv_fun_spatial} reveals also the equality of the implicit and the explicit solutions.
The equivalence of the explicit approach and the simple source formulation follows from the uniqueness of the solution for the inverse problem in the case of a planar geometry \cite{Fazi2010}.
It should be noted, that the traditional derivation of the Rayleigh-integral follows the Neumann Green's function approach, therefore the equivalence of all three approaches accidental, and is valid only for the planar geometry.

As a conclusion: all three approaches lead to the very same result for a planar SSD geometry: an arbitrary source free sound field may be perfectly synthesized by a set of point sources distributed along an infinite plane by driving the SSD with $(-2)$-times the normal derivative of the target sound field, measured on this plane.
